<!-- agent-update:start:agent-code-reviewer -->
# Code Reviewer Agent Playbook

## Mission
The Code Reviewer Agent acts as an automated, objective, and rigorous partner in the software development lifecycle. Engage this agent during Pull Request creation or when refactoring to analyze code changes for quality, maintainability, security, and adherence to project-specific conventions. It aims to reduce human review burden, catch issues early, and mentor developers through constructive, context-aware feedback.

## Responsibilities
- Review code changes for quality, style, and best practices
- Identify potential bugs, edge cases, and security vulnerabilities
- Ensure code follows project conventions and architectural guidelines
- Provide constructive, actionable feedback and code suggestions
- Validate that appropriate tests accompany new features or bug fixes

## Best Practices
- Focus on maintainability, performance, and readability
- Defer to automated linters (ESLint, Prettier) for syntax formatting; focus on logic and architecture
- Consider the broader impact of changes (e.g., database performance, API backwards compatibility)
- Be constructive, specific in feedback, and provide code examples where helpful

## Key Project Resources
- Documentation index: [docs/README.md](../docs/README.md)
- Agent handbook: [agents/README.md](./README.md)
- Agent knowledge base: [AGENTS.md](../../AGENTS.md)
- Contributor guide: [CONTRIBUTING.md](../../CONTRIBUTING.md)

## Repository Starting Points
- `agents/` — AI agent playbooks and configuration files that define agent responsibilities, workflows, and prompts.
- `docs/` — Project documentation including architecture notes, development workflows, testing strategies, and system overviews.
- `mapa-app/` — The primary frontend application codebase (e.g., React/Next.js or React Native/Expo).
- `prompts/` — Reusable LLM prompts and system instructions used by various agents or AI tooling.
- `scripts/` — Utility scripts for build, deployment, database migrations, or automation tasks.
- `snippets/` — Reusable code snippets, examples, and templates for developer reference.
- `src/` — Main source code directory for shared logic, backend services, or core application components.
- `supabase/` — Supabase configuration, database migrations, and edge functions.

## Documentation Touchpoints
- [Documentation Index](../docs/README.md) — agent-update:docs-index
- [Project Overview](../docs/project-overview.md) — agent-update:project-overview
- [Architecture Notes](../docs/architecture.md) — agent-update:architecture-notes
- [Development Workflow](../docs/development-workflow.md) — agent-update:development-workflow
- [Testing Strategy](../docs/testing-strategy.md) — agent-update:testing-strategy
- [Glossary & Domain Concepts](../docs/glossary.md) — agent-update:glossary
- [Data Flow & Integrations](../docs/data-flow.md) — agent-update:data-flow
- [Security & Compliance Notes](../docs/security.md) — agent-update:security
- [Tooling & Productivity Guide](../docs/tooling.md) — agent-update:tooling

<!-- agent-readonly:guidance -->
## Collaboration Checklist
1. Confirm assumptions with issue reporters or maintainers.
2. Review open pull requests affecting this area.
3. Update the relevant doc section listed above and remove any resolved `agent-fill` placeholders.
4. Capture learnings back in [docs/README.md](../docs/README.md) or the appropriate task marker.

## Success Metrics
Track effectiveness of this agent's contributions:
- **Code Quality:** Reduced bug count, improved test coverage, decreased technical debt
- **Velocity:** Time to complete typical tasks, deployment frequency
- **Documentation:** Coverage of features, accuracy of guides, usage by team
- **Collaboration:** PR review turnaround time, feedback quality, knowledge sharing

**Target Metrics:**
- Achieve a < 15 minute automated review turnaround time per Pull Request.
- Reduce post-merge bug reports by 30% by catching edge cases during review.
- Maintain 100% adherence to project security and architectural guidelines.
- Track false-positive feedback rates to iteratively refine and improve the agent's review prompts.

## Troubleshooting Common Issues
Document frequent problems this agent encounters and their solutions:

### Issue: Overly Pedantic or Noisy Feedback
**Symptoms:** PR is flooded with minor nitpicks about styling or formatting that distract from core logic.
**Root Cause:** The agent prompt is not properly constrained to focus on logic and architecture, or local linters were bypassed.
**Resolution:** 
1. Ignore formatting feedback generated by the agent.
2. Ensure the code passes automated CI linting (e.g., Prettier/ESLint) before invoking the agent.
**Prevention:** Enforce strict CI/CD linting rules. Update the agent's system prompt to explicitly defer styling issues to standard tooling.

### Issue: Agent Hallucinates APIs or Context
**Symptoms:** Review comments suggest using deprecated libraries, non-existent internal functions, or misunderstand the data flow.
**Root Cause:** The agent's context window lacks the latest `docs/architecture.md` or recent major refactors.
**Resolution:**
1. Provide the agent with specific, updated file paths (e.g., `supabase/migrations`, `docs/data-flow.md`).
2. Trigger a context refresh to update the agent's knowledge base.
**Prevention:** Ensure documentation is updated synchronously with major API changes and always attach relevant context files to the review request.

## Hand-off Notes
Summarize outcomes, remaining risks, and suggested follow-up actions after the agent completes its work. 
- Ensure any architectural deviations spotted during review are either corrected or documented as accepted technical debt.
- If the agent suggests a major refactor, escalate to a human maintainer before proceeding.

## Evidence to Capture
- Reference commits, issues, or ADRs used to justify updates.
- Command output or logs that informed recommendations.
- Follow-up items for maintainers or future agent runs.
- Performance metrics and benchmarks where applicable.
<!-- agent-update:end -->
